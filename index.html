<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reflect Yourself - Daily Reflection Journal</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 3px solid #000;
      }

      h1 {
        color: #000;
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .subtitle {
        color: #666;
        font-size: 1.1em;
      }

      .quote-section {
        background: linear-gradient(135deg, #000 0%, #333 100%);
        color: white;
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        text-align: center;
      }

      .quote-title {
        font-size: 0.9em;
        text-transform: uppercase;
        letter-spacing: 2px;
        margin-bottom: 15px;
        opacity: 0.8;
      }

      .quote-text {
        font-size: 1.3em;
        font-style: italic;
        line-height: 1.6;
        margin-bottom: 10px;
        font-weight: 300;
      }

      .quote-author {
        font-size: 1em;
        opacity: 0.9;
        font-weight: 500;
      }

      .calendars-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 40px;
      }

      .calendar-container {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .calendar-title {
        font-size: 1.5em;
        color: #333;
        font-weight: bold;
      }

      .calendar-nav {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .nav-btn {
        background: #000;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        transition: background 0.3s;
      }

      .nav-btn:hover {
        background: #333;
      }

      .month-year {
        font-weight: bold;
        color: #000;
        min-width: 150px;
        text-align: center;
      }

      .calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
      }

      .day-header {
        text-align: center;
        font-weight: bold;
        color: #000;
        padding: 10px;
        font-size: 0.9em;
      }

      .day {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s;
        position: relative;
      }

      .day:hover {
        transform: scale(1.1);
      }

      .day.other-month {
        color: #ccc;
      }

      .day.today {
        background: #000;
        color: white;
        font-weight: bold;
      }

      .day.complete {
        background: #28a745;
        color: white;
      }

      .day.incomplete {
        background: #dc3545;
        color: white;
      }

      .day.partial {
        background: #ffc107;
        color: white;
      }

      .questions-section {
        margin-top: 40px;
      }

      .questions-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .tab-btn {
        flex: 1;
        padding: 15px;
        border: none;
        background: #e9ecef;
        color: #666;
        font-size: 1.1em;
        font-weight: bold;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .tab-btn.active {
        background: #000;
        color: white;
      }

      .tab-btn .icon {
        font-size: 1.5em;
        display: block;
        margin-bottom: 5px;
      }

      .questions-content {
        display: none;
      }

      .questions-content.active {
        display: block;
      }

      .question-card {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        border-left: 4px solid #000;
      }

      .question-label {
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
        font-size: 1.05em;
      }

      textarea {
        width: 100%;
        min-height: 100px;
        padding: 12px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-family: inherit;
        font-size: 1em;
        resize: vertical;
        transition: border-color 0.3s;
      }

      textarea:focus {
        outline: none;
        border-color: #000;
      }

      .submit-btn {
        background: #000;
        color: white;
        border: none;
        padding: 15px 40px;
        border-radius: 10px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        display: block;
        margin: 20px auto 0;
      }

      .submit-btn:hover {
        background: #333;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      }

      .submit-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      .status-message {
        text-align: center;
        padding: 15px;
        border-radius: 10px;
        margin-top: 20px;
        font-weight: bold;
        display: none;
      }

      .status-message.success {
        background: #e8e8e8;
        color: #000;
        display: block;
      }

      .status-message.error {
        background: #f8d7da;
        color: #721c24;
        display: block;
      }

      .legend {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
        flex-wrap: wrap;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 5px;
      }

      .selected-date-info {
        text-align: center;
        padding: 15px;
        background: #e7f3ff;
        border-radius: 10px;
        margin-bottom: 20px;
        font-size: 1.1em;
        color: #004085;
      }

      /* Dashboard Styles */
      .nav-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 10px;
      }

      .nav-tab {
        padding: 12px 30px;
        border: none;
        background: transparent;
        color: #666;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: all 0.3s;
      }

      .nav-tab.active {
        color: #000;
        border-bottom-color: #000;
      }

      .nav-tab:hover {
        color: #000;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .dashboard-container {
        max-height: 600px;
        overflow-y: auto;
      }

      .day-entry {
        background: #f8f9fa;
        border-left: 4px solid #000;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .day-entry.complete {
        border-left-color: #28a745;
      }

      .day-entry.partial {
        border-left-color: #ffc107;
      }

      .day-entry.incomplete {
        border-left-color: #dc3545;
      }

      .day-entry-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e9ecef;
      }

      .day-entry-date {
        font-size: 1.2em;
        font-weight: bold;
        color: #000;
      }

      .day-entry-status {
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: bold;
        color: white;
      }

      .day-entry-status.complete {
        background: #28a745;
      }

      .day-entry-status.partial {
        background: #ffc107;
      }

      .day-entry-status.incomplete {
        background: #dc3545;
      }

      .day-entry-section {
        margin-bottom: 20px;
      }

      .section-title {
        font-size: 1.1em;
        font-weight: bold;
        color: #000;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .answer-item {
        background: white;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 10px;
      }

      .answer-question {
        font-weight: 600;
        color: #555;
        margin-bottom: 5px;
        font-size: 0.95em;
      }

      .answer-text {
        color: #333;
        line-height: 1.6;
        font-size: 0.95em;
      }

      .no-data {
        text-align: center;
        padding: 40px;
        color: #999;
        font-size: 1.1em;
      }

      /* Custom Questions Styles */
      .custom-questions-manager {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 30px;
      }

      .custom-section-list {
        margin-bottom: 20px;
      }

      .custom-section-item {
        background: white;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
        border-left: 4px solid #000;
      }

      .custom-section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .custom-section-title {
        font-weight: bold;
        font-size: 1.1em;
        color: #000;
      }

      .custom-section-actions {
        display: flex;
        gap: 10px;
      }

      .btn-small {
        padding: 5px 12px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.85em;
        font-weight: bold;
        transition: all 0.3s;
      }

      .btn-edit {
        background: #000;
        color: white;
      }

      .btn-edit:hover {
        background: #333;
      }

      .btn-delete {
        background: #dc3545;
        color: white;
      }

      .btn-delete:hover {
        background: #c82333;
      }

      .add-section-btn {
        background: #000;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        font-weight: bold;
        transition: all 0.3s;
      }

      .add-section-btn:hover {
        background: #333;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
      }

      .modal.active {
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: white;
        border-radius: 15px;
        padding: 30px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }

      .modal-header {
        font-size: 1.5em;
        font-weight: bold;
        margin-bottom: 20px;
        color: #000;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        font-weight: bold;
        margin-bottom: 8px;
        color: #333;
      }

      .form-input {
        width: 100%;
        padding: 10px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 1em;
        font-family: inherit;
      }

      .form-input:focus {
        outline: none;
        border-color: #000;
      }

      .question-list {
        margin-top: 15px;
      }

      .question-item {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 20px;
      }

      .btn-cancel {
        background: #6c757d;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
      }

      .btn-cancel:hover {
        background: #5a6268;
      }

      .btn-save {
        background: #000;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        font-weight: bold;
      }

      .btn-save:hover {
        background: #333;
      }

      @media (max-width: 968px) {
        .calendars-section {
          grid-template-columns: 1fr;
        }

        h1 {
          font-size: 2em;
        }

        .calendar {
          gap: 5px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üåü Reflect Yourself üåü</h1>
        <p class="subtitle">Daily Reflection & Gratitude Journal</p>
      </header>

      <!-- Navigation Tabs -->
      <div class="nav-tabs">
        <button class="nav-tab active" onclick="showTab('today')">
          üìù Today
        </button>
        <button class="nav-tab" onclick="showTab('dashboard')">
          üìä Dashboard
        </button>
        <button class="nav-tab" onclick="showTab('custom')">
          ‚öôÔ∏è Custom Questions
        </button>
      </div>

      <!-- Today Tab Content -->
      <div class="tab-content active" id="today-content">
        <!-- Quote of the Day -->
        <div class="quote-section">
          <div class="quote-title">‚ú® Quote of the Day ‚ú®</div>
          <div class="quote-text" id="quote-text"></div>
          <div class="quote-author" id="quote-author"></div>
        </div>

        <!-- Calendars Section -->
        <div class="calendars-section">
          <!-- AD Calendar -->
          <div class="calendar-container">
            <div class="calendar-header">
              <h2 class="calendar-title">üìÖ AD Calendar</h2>
              <div class="calendar-nav">
                <button class="nav-btn" onclick="changeMonth('ad', -1)">
                  ‚óÄ
                </button>
                <span class="month-year" id="ad-month-year"></span>
                <button class="nav-btn" onclick="changeMonth('ad', 1)">
                  ‚ñ∂
                </button>
              </div>
            </div>
            <div class="calendar" id="ad-calendar"></div>
          </div>

          <!-- Nepali Calendar -->
          <div class="calendar-container">
            <div class="calendar-header">
              <h2 class="calendar-title">üóìÔ∏è Nepali Calendar</h2>
              <div class="calendar-nav">
                <button class="nav-btn" onclick="changeMonth('nepali', -1)">
                  ‚óÄ
                </button>
                <span class="month-year" id="nepali-month-year"></span>
                <button class="nav-btn" onclick="changeMonth('nepali', 1)">
                  ‚ñ∂
                </button>
              </div>
            </div>
            <div class="calendar" id="nepali-calendar"></div>
          </div>
        </div>

        <!-- Legend -->
        <div class="legend">
          <div class="legend-item">
            <div class="legend-color" style="background: #28a745"></div>
            <span>Complete (Both)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #ffc107"></div>
            <span>Partial (One)</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #dc3545"></div>
            <span>Incomplete</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #000"></div>
            <span>Today</span>
          </div>
        </div>

        <!-- Questions Section -->
        <div class="questions-section">
          <div class="questions-tabs">
            <button class="tab-btn active" onclick="switchTab('morning')">
              <span class="icon">‚òÄÔ∏è</span>
              Morning Questions
            </button>
            <button class="tab-btn" onclick="switchTab('evening')">
              <span class="icon">üåô</span>
              Evening Questions
            </button>
          </div>

          <!-- Morning Questions -->
          <div class="questions-content active" id="morning-questions">
            <div class="question-card">
              <div class="question-label">1. What is the main task today?</div>
              <textarea
                id="morning-q1"
                placeholder="Write your answer here..."
              ></textarea>
            </div>
            <div class="question-card">
              <div class="question-label">
                2. What am I going to give myself today?
              </div>
              <textarea
                id="morning-q2"
                placeholder="Write your answer here..."
              ></textarea>
            </div>
            <div class="question-card">
              <div class="question-label">
                3. What am I going to give others today?
              </div>
              <textarea
                id="morning-q3"
                placeholder="Write your answer here..."
              ></textarea>
            </div>
            <div class="question-card">
              <div class="question-label">
                4. What am I happy about right now?
              </div>
              <textarea
                id="morning-q4"
                placeholder="Write your answer here..."
              ></textarea>
            </div>
            <div class="question-card">
              <div class="question-label">
                5. What are 10 things that I am grateful for in life?
              </div>
              <textarea
                id="morning-q5"
                placeholder="Write your answer here..."
              ></textarea>
            </div>
            <div class="question-card">
              <div class="question-label">
                6. For what and for whom am I grateful in life?
              </div>
              <textarea
                id="morning-q6"
                placeholder="Write your answer here..."
              ></textarea>
            </div>
            <div class="question-card">
              <div class="question-label">
                7. How can I increase my productivity today?
              </div>
              <textarea
                id="morning-q7"
                placeholder="Write your answer here..."
              ></textarea>
            </div>
            <button class="submit-btn" onclick="submitAnswers('morning')">
              Submit Morning Reflection
            </button>
            <div class="status-message" id="morning-status"></div>
          </div>

          <!-- Evening Questions -->
          <div class="questions-content" id="evening-questions">
            <div class="question-card">
              <div class="question-label">
                1. What did I do today to move closer to my aim or goal?
              </div>
              <textarea
                id="evening-q1"
                placeholder="Write your answer here..."
              ></textarea>
            </div>
            <div class="question-card">
              <div class="question-label">
                2. Did my actions reflect my priorities or excuses?
              </div>
              <textarea
                id="evening-q2"
                placeholder="Write your answer here..."
              ></textarea>
            </div>
            <div class="question-card">
              <div class="question-label">
                3. Where did I waste my energy or get distracted?
              </div>
              <textarea
                id="evening-q3"
                placeholder="Write your answer here..."
              ></textarea>
            </div>
            <div class="question-card">
              <div class="question-label">
                4. If every day looked like today, would I hit my goal?
              </div>
              <textarea
                id="evening-q4"
                placeholder="Write your answer here..."
              ></textarea>
            </div>
            <div class="question-card">
              <div class="question-label">
                5. Where am I winning in my life?
              </div>
              <textarea
                id="evening-q5"
                placeholder="Write your answer here..."
              ></textarea>
            </div>
            <button class="submit-btn" onclick="submitAnswers('evening')">
              Submit Evening Reflection
            </button>
            <div class="status-message" id="evening-status"></div>
          </div>
        </div>
      </div>
      <!-- End Today Tab -->

      <!-- Dashboard Tab Content -->
      <div class="tab-content" id="dashboard-content">
        <h2 style="margin-bottom: 20px; color: #000">
          üìä Last 15 Days Reflections
        </h2>
        <div class="dashboard-container" id="dashboard-container"></div>
      </div>
      <!-- End Dashboard Tab -->

      <!-- Custom Questions Tab Content -->
      <div class="tab-content" id="custom-content">
        <h2 style="margin-bottom: 20px; color: #000">
          ‚öôÔ∏è Manage Custom Question Sets
        </h2>
        <div class="custom-questions-manager">
          <div class="custom-section-list" id="custom-section-list"></div>
          <button class="add-section-btn" onclick="openAddSectionModal()">
            + Add New Question Set
          </button>
        </div>
      </div>
      <!-- End Custom Questions Tab -->
    </div>

    <!-- Modal for Adding/Editing Custom Questions -->
    <div class="modal" id="custom-modal">
      <div class="modal-content">
        <div class="modal-header" id="modal-title">Add New Question Set</div>
        <div class="form-group">
          <label class="form-label"
            >Section Title (e.g., Morning, Evening, Weekly Review)</label
          >
          <input
            type="text"
            class="form-input"
            id="section-title"
            placeholder="Enter section title"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Section Icon (emoji)</label>
          <input
            type="text"
            class="form-input"
            id="section-icon"
            placeholder="e.g., ‚òÄÔ∏è, üåô, üìù"
            maxlength="2"
          />
        </div>
        <div class="form-group">
          <label class="form-label">Questions</label>
          <div class="question-list" id="question-list"></div>
          <button
            class="add-section-btn"
            style="margin-top: 10px; padding: 8px 15px; font-size: 0.9em"
            onclick="addQuestionField()"
          >
            + Add Question
          </button>
        </div>
        <div class="modal-actions">
          <button class="btn-cancel" onclick="closeModal()">Cancel</button>
          <button class="btn-save" onclick="saveCustomSection()">Save</button>
        </div>
      </div>
    </div>

    <script>
      // Quote of the Day Database
      const quotes = [
        {
          text: "The only way to do great work is to love what you do.",
          author: "Steve Jobs",
        },
        {
          text: "Believe you can and you're halfway there.",
          author: "Theodore Roosevelt",
        },
        {
          text: "Success is not final, failure is not fatal: it is the courage to continue that counts.",
          author: "Winston Churchill",
        },
        {
          text: "The future belongs to those who believe in the beauty of their dreams.",
          author: "Eleanor Roosevelt",
        },
        {
          text: "It does not matter how slowly you go as long as you do not stop.",
          author: "Confucius",
        },
        {
          text: "Everything you've ever wanted is on the other side of fear.",
          author: "George Addair",
        },
        {
          text: "Believe in yourself. You are braver than you think, more talented than you know, and capable of more than you imagine.",
          author: "Roy T. Bennett",
        },
        {
          text: "I learned that courage was not the absence of fear, but the triumph over it.",
          author: "Nelson Mandela",
        },
        {
          text: "There is only one way to avoid criticism: do nothing, say nothing, and be nothing.",
          author: "Aristotle",
        },
        {
          text: "Do what you can with all you have, wherever you are.",
          author: "Theodore Roosevelt",
        },
        {
          text: "You are never too old to set another goal or to dream a new dream.",
          author: "C.S. Lewis",
        },
        {
          text: "The way to get started is to quit talking and begin doing.",
          author: "Walt Disney",
        },
        {
          text: "Don't watch the clock; do what it does. Keep going.",
          author: "Sam Levenson",
        },
        {
          text: "The only impossible journey is the one you never begin.",
          author: "Tony Robbins",
        },
        {
          text: "In the end, we only regret the chances we didn't take.",
          author: "Lewis Carroll",
        },
        {
          text: "Act as if what you do makes a difference. It does.",
          author: "William James",
        },
        {
          text: "Success is not how high you have climbed, but how you make a positive difference to the world.",
          author: "Roy T. Bennett",
        },
        {
          text: "What lies behind us and what lies before us are tiny matters compared to what lies within us.",
          author: "Ralph Waldo Emerson",
        },
        {
          text: "You must be the change you wish to see in the world.",
          author: "Mahatma Gandhi",
        },
        {
          text: "The best time to plant a tree was 20 years ago. The second best time is now.",
          author: "Chinese Proverb",
        },
        {
          text: "Your time is limited, don't waste it living someone else's life.",
          author: "Steve Jobs",
        },
        {
          text: "Life is 10% what happens to you and 90% how you react to it.",
          author: "Charles R. Swindoll",
        },
        {
          text: "The only person you are destined to become is the person you decide to be.",
          author: "Ralph Waldo Emerson",
        },
        {
          text: "Go confidently in the direction of your dreams! Live the life you've imagined.",
          author: "Henry David Thoreau",
        },
        {
          text: "When you have a dream, you've got to grab it and never let go.",
          author: "Carol Burnett",
        },
        {
          text: "It is never too late to be what you might have been.",
          author: "George Eliot",
        },
        {
          text: "Everything has beauty, but not everyone can see.",
          author: "Confucius",
        },
        {
          text: "The mind is everything. What you think you become.",
          author: "Buddha",
        },
        {
          text: "The best revenge is massive success.",
          author: "Frank Sinatra",
        },
        {
          text: "Do one thing every day that scares you.",
          author: "Eleanor Roosevelt",
        },
        {
          text: "Happiness is not by chance, but by choice.",
          author: "Jim Rohn",
        },
      ];

      // Display Quote of the Day
      function displayQuoteOfTheDay() {
        const today = new Date();
        const dayOfYear = Math.floor(
          (today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24
        );
        const quoteIndex = dayOfYear % quotes.length;
        const dailyQuote = quotes[quoteIndex];

        document.getElementById(
          "quote-text"
        ).textContent = `"${dailyQuote.text}"`;
        document.getElementById(
          "quote-author"
        ).textContent = `‚Äî ${dailyQuote.author}`;
      }

      // Nepali Calendar Data (BS)
      const nepaliMonths = [
        "Baisakh",
        "Jestha",
        "Ashadh",
        "Shrawan",
        "Bhadra",
        "Ashwin",
        "Kartik",
        "Mangsir",
        "Poush",
        "Magh",
        "Falgun",
        "Chaitra",
      ];

      // Nepali calendar days per month for years 2080-2085
      const nepaliCalendarData = {
        2080: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
        2081: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2082: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
        2083: [30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
        2084: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
        2085: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
      };

      // State
      let currentADDate = new Date();
      let currentNepaliDate = adToNepali(currentADDate);
      let reflectionData =
        JSON.parse(localStorage.getItem("reflectionData")) || {};
      let customQuestions =
        JSON.parse(localStorage.getItem("customQuestions")) || [];
      let editingIndex = -1;

      // Get today's date key
      function getTodayDateKey() {
        const today = new Date();
        return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(
          2,
          "0"
        )}-${String(today.getDate()).padStart(2, "0")}`;
      }

      // Initialize
      function init() {
        displayQuoteOfTheDay();
        renderADCalendar();
        renderNepaliCalendar();
        loadTodayAnswers();
        renderCustomQuestionSets();
      }

      // Tab Navigation
      function showTab(tabName) {
        // Update tab buttons
        document.querySelectorAll(".nav-tab").forEach((tab) => {
          tab.classList.remove("active");
        });
        event.target.classList.add("active");

        // Update tab content
        document.querySelectorAll(".tab-content").forEach((content) => {
          content.classList.remove("active");
        });
        document.getElementById(`${tabName}-content`).classList.add("active");

        // Load dashboard if switching to it
        if (tabName === "dashboard") {
          renderDashboard();
        }
      }

      // Render Dashboard
      function renderDashboard() {
        const container = document.getElementById("dashboard-container");
        container.innerHTML = "";

        const today = new Date();
        const entries = [];

        // Get last 15 days
        for (let i = 0; i < 15; i++) {
          const date = new Date(today);
          date.setDate(date.getDate() - i);
          const dateKey = `${date.getFullYear()}-${String(
            date.getMonth() + 1
          ).padStart(2, "0")}-${String(date.getDate()).padStart(2, "0")}`;

          const data = reflectionData[dateKey];
          const hasMorning =
            data?.morning && Object.values(data.morning).some((v) => v);
          const hasEvening =
            data?.evening && Object.values(data.evening).some((v) => v);

          let status = "incomplete";
          if (hasMorning && hasEvening) status = "complete";
          else if (hasMorning || hasEvening) status = "partial";

          entries.push({
            date: date,
            dateKey: dateKey,
            data: data,
            status: status,
            hasMorning: hasMorning,
            hasEvening: hasEvening,
          });
        }

        // Render entries
        entries.forEach((entry) => {
          const entryDiv = document.createElement("div");
          entryDiv.className = `day-entry ${entry.status}`;

          const dateStr = entry.date.toLocaleDateString("en-US", {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          });

          const statusText =
            entry.status === "complete"
              ? "‚úì Complete"
              : entry.status === "partial"
              ? "‚óê Partial"
              : "‚úó Incomplete";

          let html = `
            <div class="day-entry-header">
              <div class="day-entry-date">${dateStr}</div>
              <div class="day-entry-status ${entry.status}">${statusText}</div>
            </div>
          `;

          // Morning section
          if (entry.hasMorning) {
            html += '<div class="day-entry-section">';
            html += '<div class="section-title">‚òÄÔ∏è Morning Reflection</div>';
            const morningQuestions = [
              "What is the main task today?",
              "What am I going to give myself today?",
              "What am I going to give others today?",
              "What am I happy about right now?",
              "What are 10 things that I am grateful for in life?",
              "For what and for whom am I grateful in life?",
              "How can I increase my productivity today?",
            ];
            for (let i = 1; i <= 7; i++) {
              const answer = entry.data.morning[`q${i}`];
              if (answer) {
                html += `
                  <div class="answer-item">
                    <div class="answer-question">${i}. ${
                  morningQuestions[i - 1]
                }</div>
                    <div class="answer-text">${answer}</div>
                  </div>
                `;
              }
            }
            html += "</div>";
          }

          // Evening section
          if (entry.hasEvening) {
            html += '<div class="day-entry-section">';
            html += '<div class="section-title">üåô Evening Reflection</div>';
            const eveningQuestions = [
              "What did I do today to move closer to my aim or goal?",
              "Did my actions reflect my priorities or excuses?",
              "Where did I waste my energy or get distracted?",
              "If every day looked like today, would I hit my goal?",
              "Where am I winning in my life?",
            ];
            for (let i = 1; i <= 5; i++) {
              const answer = entry.data.evening[`q${i}`];
              if (answer) {
                html += `
                  <div class="answer-item">
                    <div class="answer-question">${i}. ${
                  eveningQuestions[i - 1]
                }</div>
                    <div class="answer-text">${answer}</div>
                  </div>
                `;
              }
            }
            html += "</div>";
          }

          if (!entry.hasMorning && !entry.hasEvening) {
            html +=
              '<div class="no-data">No reflections recorded for this day</div>';
          }

          entryDiv.innerHTML = html;
          container.appendChild(entryDiv);
        });
      }

      // AD Calendar
      function renderADCalendar() {
        const calendar = document.getElementById("ad-calendar");
        const year = currentADDate.getFullYear();
        const month = currentADDate.getMonth();

        const monthNames = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];
        document.getElementById(
          "ad-month-year"
        ).textContent = `${monthNames[month]} ${year}`;

        calendar.innerHTML = "";

        // Day headers
        const dayHeaders = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        dayHeaders.forEach((day) => {
          const header = document.createElement("div");
          header.className = "day-header";
          header.textContent = day;
          calendar.appendChild(header);
        });

        // First day of month and total days
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const prevMonthDays = new Date(year, month, 0).getDate();

        // Previous month days
        for (let i = firstDay - 1; i >= 0; i--) {
          const day = document.createElement("div");
          day.className = "day other-month";
          day.textContent = prevMonthDays - i;
          calendar.appendChild(day);
        }

        // Current month days
        for (let i = 1; i <= daysInMonth; i++) {
          const day = document.createElement("div");
          day.className = "day";
          day.textContent = i;

          const dateKey = `${year}-${String(month + 1).padStart(
            2,
            "0"
          )}-${String(i).padStart(2, "0")}`;
          const today = new Date();
          const isToday =
            year === today.getFullYear() &&
            month === today.getMonth() &&
            i === today.getDate();

          if (isToday) {
            day.classList.add("today");
          }

          // Check completion status
          const status = getDateStatus(dateKey);
          if (status === "complete") {
            day.classList.add("complete");
          } else if (status === "partial") {
            day.classList.add("partial");
          } else if (status === "incomplete") {
            const dayDate = new Date(year, month, i);
            if (dayDate < today) {
              day.classList.add("incomplete");
            }
          }

          calendar.appendChild(day);
        }

        // Next month days
        const remainingCells = 42 - (firstDay + daysInMonth);
        for (let i = 1; i <= remainingCells; i++) {
          const day = document.createElement("div");
          day.className = "day other-month";
          day.textContent = i;
          calendar.appendChild(day);
        }
      }

      // Nepali Calendar
      function renderNepaliCalendar() {
        const calendar = document.getElementById("nepali-calendar");
        const year = currentNepaliDate.year;
        const month = currentNepaliDate.month;

        document.getElementById(
          "nepali-month-year"
        ).textContent = `${nepaliMonths[month]} ${year}`;

        calendar.innerHTML = "";

        // Day headers
        const dayHeaders = [
          "‡§Ü‡§á‡§§",
          "‡§∏‡•ã‡§Æ",
          "‡§Æ‡§Ç‡§ó‡§≤",
          "‡§¨‡•Å‡§ß",
          "‡§¨‡§ø‡§π‡§ø",
          "‡§∂‡•Å‡§ï‡•ç‡§∞",
          "‡§∂‡§®‡§ø",
        ];
        dayHeaders.forEach((day) => {
          const header = document.createElement("div");
          header.className = "day-header";
          header.textContent = day;
          calendar.appendChild(header);
        });

        // Calculate first day of Nepali month
        const firstDayAD = nepaliToAD(year, month, 1);
        const firstDay = firstDayAD.getDay();

        const daysInMonth = nepaliCalendarData[year]?.[month] || 30;
        const prevMonthDays =
          month > 0
            ? nepaliCalendarData[year]?.[month - 1] || 30
            : nepaliCalendarData[year - 1]?.[11] || 30;

        // Previous month days
        for (let i = firstDay - 1; i >= 0; i--) {
          const day = document.createElement("div");
          day.className = "day other-month";
          day.textContent = prevMonthDays - i;
          calendar.appendChild(day);
        }

        // Current month days
        const todayNepali = adToNepali(new Date());
        for (let i = 1; i <= daysInMonth; i++) {
          const day = document.createElement("div");
          day.className = "day";
          day.textContent = i;

          const isToday =
            year === todayNepali.year &&
            month === todayNepali.month &&
            i === todayNepali.day;
          if (isToday) {
            day.classList.add("today");
          }

          // Get corresponding AD date for status check
          const adDate = nepaliToAD(year, month, i);
          const dateKey = `${adDate.getFullYear()}-${String(
            adDate.getMonth() + 1
          ).padStart(2, "0")}-${String(adDate.getDate()).padStart(2, "0")}`;

          const status = getDateStatus(dateKey);
          if (status === "complete") {
            day.classList.add("complete");
          } else if (status === "partial") {
            day.classList.add("partial");
          } else if (status === "incomplete") {
            if (adDate < new Date()) {
              day.classList.add("incomplete");
            }
          }

          calendar.appendChild(day);
        }

        // Next month days
        const remainingCells = 42 - (firstDay + daysInMonth);
        for (let i = 1; i <= remainingCells; i++) {
          const day = document.createElement("div");
          day.className = "day other-month";
          day.textContent = i;
          calendar.appendChild(day);
        }
      }

      // Date conversion functions (simplified)
      function adToNepali(adDate) {
        // Base date: 2024-04-13 = 2081-01-01
        const baseAD = new Date(2024, 3, 13);
        const baseNepali = { year: 2081, month: 0, day: 1 };

        const diffTime = adDate - baseAD;
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

        let year = baseNepali.year;
        let month = baseNepali.month;
        let day = baseNepali.day + diffDays;

        while (day > (nepaliCalendarData[year]?.[month] || 30)) {
          day -= nepaliCalendarData[year]?.[month] || 30;
          month++;
          if (month > 11) {
            month = 0;
            year++;
          }
        }

        while (day < 1) {
          month--;
          if (month < 0) {
            month = 11;
            year--;
          }
          day += nepaliCalendarData[year]?.[month] || 30;
        }

        return { year, month, day };
      }

      function nepaliToAD(year, month, day) {
        // Base date: 2081-01-01 = 2024-04-13
        const baseAD = new Date(2024, 3, 13);
        const baseNepali = { year: 2081, month: 0, day: 1 };

        let totalDays = 0;

        // Add days for complete years
        for (let y = baseNepali.year; y < year; y++) {
          totalDays += (nepaliCalendarData[y] || []).reduce(
            (a, b) => a + b,
            365
          );
        }

        // Add days for complete months in current year
        for (let m = 0; m < month; m++) {
          totalDays += nepaliCalendarData[year]?.[m] || 30;
        }

        // Add remaining days
        totalDays += day - baseNepali.day;

        const result = new Date(baseAD);
        result.setDate(result.getDate() + totalDays);
        return result;
      }

      // Navigation
      function changeMonth(calendar, direction) {
        if (calendar === "ad") {
          currentADDate.setMonth(currentADDate.getMonth() + direction);
          renderADCalendar();
        } else {
          currentNepaliDate.month += direction;
          if (currentNepaliDate.month > 11) {
            currentNepaliDate.month = 0;
            currentNepaliDate.year++;
          } else if (currentNepaliDate.month < 0) {
            currentNepaliDate.month = 11;
            currentNepaliDate.year--;
          }
          renderNepaliCalendar();
        }
      }

      // Tab switching
      function switchTab(tab) {
        document
          .querySelectorAll(".tab-btn")
          .forEach((btn) => btn.classList.remove("active"));
        document
          .querySelectorAll(".questions-content")
          .forEach((content) => content.classList.remove("active"));

        event.target.closest(".tab-btn").classList.add("active");
        document.getElementById(`${tab}-questions`).classList.add("active");
      }

      // Load today's answers
      function loadTodayAnswers() {
        const dateKey = getTodayDateKey();
        const data = reflectionData[dateKey] || {};

        // Load morning answers
        for (let i = 1; i <= 7; i++) {
          const textarea = document.getElementById(`morning-q${i}`);
          textarea.value = data.morning?.[`q${i}`] || "";
        }

        // Load evening answers
        for (let i = 1; i <= 5; i++) {
          const textarea = document.getElementById(`evening-q${i}`);
          textarea.value = data.evening?.[`q${i}`] || "";
        }

        // Clear status messages
        document.getElementById("morning-status").style.display = "none";
        document.getElementById("evening-status").style.display = "none";
      }

      // Submit answers
      function submitAnswers(type) {
        const dateKey = getTodayDateKey();
        const numQuestions = type === "morning" ? 7 : 5;
        const answers = {};
        let allFilled = true;

        for (let i = 1; i <= numQuestions; i++) {
          const textarea = document.getElementById(`${type}-q${i}`);
          answers[`q${i}`] = textarea.value.trim();
          if (!answers[`q${i}`]) {
            allFilled = false;
          }
        }

        if (!allFilled) {
          const confirmed = confirm(
            "Some questions are not answered. Do you want to save anyway?"
          );
          if (!confirmed) return;
        }

        // Save to storage
        if (!reflectionData[dateKey]) {
          reflectionData[dateKey] = {};
        }
        reflectionData[dateKey][type] = answers;
        reflectionData[dateKey][`${type}Timestamp`] = new Date().toISOString();

        localStorage.setItem("reflectionData", JSON.stringify(reflectionData));

        // Show success message
        const statusDiv = document.getElementById(`${type}-status`);
        statusDiv.className = "status-message success";
        statusDiv.textContent = `‚úì ${
          type.charAt(0).toUpperCase() + type.slice(1)
        } reflection saved successfully!`;
        statusDiv.style.display = "block";

        setTimeout(() => {
          statusDiv.style.display = "none";
        }, 3000);

        // Refresh calendars to update status
        renderADCalendar();
        renderNepaliCalendar();
      }

      // Get date status
      function getDateStatus(dateKey) {
        const data = reflectionData[dateKey];
        if (!data) return null;

        const hasMorning =
          data.morning && Object.values(data.morning).some((v) => v);
        const hasEvening =
          data.evening && Object.values(data.evening).some((v) => v);

        if (hasMorning && hasEvening) return "complete";
        if (hasMorning || hasEvening) return "partial";
        return null;
      }

      // Custom Questions Management
      function renderCustomQuestionSets() {
        const container = document.getElementById("custom-section-list");
        container.innerHTML = "";

        if (customQuestions.length === 0) {
          container.innerHTML =
            '<div class="no-data">No custom question sets yet. Add one to get started!</div>';
          return;
        }

        customQuestions.forEach((section, index) => {
          const sectionDiv = document.createElement("div");
          sectionDiv.className = "custom-section-item";
          sectionDiv.innerHTML = `
            <div class="custom-section-header">
              <div class="custom-section-title">${section.icon} ${
            section.title
          } (${section.questions.length} questions)</div>
              <div class="custom-section-actions">
                <button class="btn-small btn-edit" onclick="editSection(${index})">Edit</button>
                <button class="btn-small btn-delete" onclick="deleteSection(${index})">Delete</button>
              </div>
            </div>
            <div style="color: #666; font-size: 0.9em;">
              ${section.questions.map((q, i) => `${i + 1}. ${q}`).join("<br>")}
            </div>
          `;
          container.appendChild(sectionDiv);
        });
      }

      function openAddSectionModal() {
        editingIndex = -1;
        document.getElementById("modal-title").textContent =
          "Add New Question Set";
        document.getElementById("section-title").value = "";
        document.getElementById("section-icon").value = "";
        document.getElementById("question-list").innerHTML = "";
        addQuestionField();
        document.getElementById("custom-modal").classList.add("active");
      }

      function editSection(index) {
        editingIndex = index;
        const section = customQuestions[index];
        document.getElementById("modal-title").textContent =
          "Edit Question Set";
        document.getElementById("section-title").value = section.title;
        document.getElementById("section-icon").value = section.icon;

        const questionList = document.getElementById("question-list");
        questionList.innerHTML = "";
        section.questions.forEach((q) => addQuestionField(q));

        document.getElementById("custom-modal").classList.add("active");
      }

      function deleteSection(index) {
        if (confirm("Are you sure you want to delete this question set?")) {
          customQuestions.splice(index, 1);
          localStorage.setItem(
            "customQuestions",
            JSON.stringify(customQuestions)
          );
          renderCustomQuestionSets();
          renderCustomQuestions();
        }
      }

      function addQuestionField(value = "") {
        const questionList = document.getElementById("question-list");
        const questionDiv = document.createElement("div");
        questionDiv.className = "question-item";
        questionDiv.innerHTML = `
          <input type="text" class="form-input" placeholder="Enter question" value="${value}" style="flex: 1; margin-right: 10px;">
          <button class="btn-small btn-delete" onclick="this.parentElement.remove()">Remove</button>
        `;
        questionList.appendChild(questionDiv);
      }

      function closeModal() {
        document.getElementById("custom-modal").classList.remove("active");
      }

      function saveCustomSection() {
        const title = document.getElementById("section-title").value.trim();
        const icon =
          document.getElementById("section-icon").value.trim() || "üìù";
        const questionInputs = document.querySelectorAll(
          "#question-list input"
        );
        const questions = Array.from(questionInputs)
          .map((input) => input.value.trim())
          .filter((q) => q.length > 0);

        if (!title) {
          alert("Please enter a section title");
          return;
        }

        if (questions.length === 0) {
          alert("Please add at least one question");
          return;
        }

        const section = { title, icon, questions };

        if (editingIndex >= 0) {
          customQuestions[editingIndex] = section;
        } else {
          customQuestions.push(section);
        }

        localStorage.setItem(
          "customQuestions",
          JSON.stringify(customQuestions)
        );
        closeModal();
        renderCustomQuestionSets();
        renderCustomQuestions();
      }

      function renderCustomQuestions() {
        const questionsSection = document.querySelector(".questions-section");

        // Remove existing custom sections
        document
          .querySelectorAll(".custom-questions-content")
          .forEach((el) => el.remove());
        document
          .querySelectorAll(".custom-tab-btn")
          .forEach((el) => el.remove());

        if (customQuestions.length === 0) return;

        // Add tabs for custom questions
        const tabsContainer = document.querySelector(".questions-tabs");
        customQuestions.forEach((section, index) => {
          const tabBtn = document.createElement("button");
          tabBtn.className = "tab-btn custom-tab-btn";
          tabBtn.onclick = () => switchTab(`custom-${index}`);
          tabBtn.innerHTML = `<span class="icon">${section.icon}</span>${section.title}`;
          tabsContainer.appendChild(tabBtn);
        });

        // Add content for custom questions
        customQuestions.forEach((section, index) => {
          const contentDiv = document.createElement("div");
          contentDiv.className = "questions-content custom-questions-content";
          contentDiv.id = `custom-${index}-questions`;

          let html = "";
          section.questions.forEach((question, qIndex) => {
            html += `
              <div class="question-card">
                <div class="question-label">${qIndex + 1}. ${question}</div>
                <textarea id="custom-${index}-q${
              qIndex + 1
            }" placeholder="Write your answer here..."></textarea>
              </div>
            `;
          });

          html += `
            <button class="submit-btn" onclick="submitCustomAnswers(${index})">
              Submit ${section.title} Reflection
            </button>
            <div class="status-message" id="custom-${index}-status"></div>
          `;

          contentDiv.innerHTML = html;
          questionsSection.appendChild(contentDiv);
        });
      }

      function submitCustomAnswers(sectionIndex) {
        const dateKey = getTodayDateKey();
        const section = customQuestions[sectionIndex];
        const answers = {};
        let allFilled = true;

        section.questions.forEach((q, qIndex) => {
          const textarea = document.getElementById(
            `custom-${sectionIndex}-q${qIndex + 1}`
          );
          answers[`q${qIndex + 1}`] = textarea.value.trim();
          if (!answers[`q${qIndex + 1}`]) {
            allFilled = false;
          }
        });

        if (!allFilled) {
          const confirmed = confirm(
            "Some questions are not answered. Do you want to save anyway?"
          );
          if (!confirmed) return;
        }

        // Save to storage
        if (!reflectionData[dateKey]) {
          reflectionData[dateKey] = {};
        }
        reflectionData[dateKey][`custom_${sectionIndex}`] = answers;
        reflectionData[dateKey][`custom_${sectionIndex}_timestamp`] =
          new Date().toISOString();
        reflectionData[dateKey][`custom_${sectionIndex}_title`] = section.title;
        reflectionData[dateKey][`custom_${sectionIndex}_icon`] = section.icon;

        localStorage.setItem("reflectionData", JSON.stringify(reflectionData));

        // Show success message
        const statusDiv = document.getElementById(
          `custom-${sectionIndex}-status`
        );
        statusDiv.className = "status-message success";
        statusDiv.textContent = `‚úì ${section.title} reflection saved successfully!`;
        statusDiv.style.display = "block";

        setTimeout(() => {
          statusDiv.style.display = "none";
        }, 3000);

        // Refresh calendars
        renderADCalendar();
        renderNepaliCalendar();
      }

      // Custom Questions Management
      function renderCustomQuestionSets() {
        const container = document.getElementById("custom-section-list");
        container.innerHTML = "";

        if (customQuestions.length === 0) {
          container.innerHTML =
            '<div class="no-data">No custom question sets yet. Add one to get started!</div>';
          return;
        }

        customQuestions.forEach((section, index) => {
          const sectionDiv = document.createElement("div");
          sectionDiv.className = "custom-section-item";
          sectionDiv.innerHTML = `
            <div class="custom-section-header">
              <div class="custom-section-title">${section.icon} ${
            section.title
          } (${section.questions.length} questions)</div>
              <div class="custom-section-actions">
                <button class="btn-small btn-edit" onclick="editSection(${index})">Edit</button>
                <button class="btn-small btn-delete" onclick="deleteSection(${index})">Delete</button>
              </div>
            </div>
            <div style="color: #666; font-size: 0.9em;">
              ${section.questions.map((q, i) => `${i + 1}. ${q}`).join("<br>")}
            </div>
          `;
          container.appendChild(sectionDiv);
        });
      }

      function openAddSectionModal() {
        editingIndex = -1;
        document.getElementById("modal-title").textContent =
          "Add New Question Set";
        document.getElementById("section-title").value = "";
        document.getElementById("section-icon").value = "";
        document.getElementById("question-list").innerHTML = "";
        addQuestionField();
        document.getElementById("custom-modal").classList.add("active");
      }

      function editSection(index) {
        editingIndex = index;
        const section = customQuestions[index];
        document.getElementById("modal-title").textContent =
          "Edit Question Set";
        document.getElementById("section-title").value = section.title;
        document.getElementById("section-icon").value = section.icon;

        const questionList = document.getElementById("question-list");
        questionList.innerHTML = "";
        section.questions.forEach((q) => addQuestionField(q));

        document.getElementById("custom-modal").classList.add("active");
      }

      function deleteSection(index) {
        if (confirm("Are you sure you want to delete this question set?")) {
          customQuestions.splice(index, 1);
          localStorage.setItem(
            "customQuestions",
            JSON.stringify(customQuestions)
          );
          renderCustomQuestionSets();
          renderCustomQuestions();
        }
      }

      function addQuestionField(value = "") {
        const questionList = document.getElementById("question-list");
        const questionDiv = document.createElement("div");
        questionDiv.className = "question-item";
        questionDiv.innerHTML = `
          <input type="text" class="form-input" placeholder="Enter question" value="${value}" style="flex: 1; margin-right: 10px;">
          <button class="btn-small btn-delete" onclick="this.parentElement.remove()">Remove</button>
        `;
        questionList.appendChild(questionDiv);
      }

      function closeModal() {
        document.getElementById("custom-modal").classList.remove("active");
      }

      function saveCustomSection() {
        const title = document.getElementById("section-title").value.trim();
        const icon =
          document.getElementById("section-icon").value.trim() || "üìù";
        const questionInputs = document.querySelectorAll(
          "#question-list input"
        );
        const questions = Array.from(questionInputs)
          .map((input) => input.value.trim())
          .filter((q) => q.length > 0);

        if (!title) {
          alert("Please enter a section title");
          return;
        }

        if (questions.length === 0) {
          alert("Please add at least one question");
          return;
        }

        const section = { title, icon, questions };

        if (editingIndex >= 0) {
          customQuestions[editingIndex] = section;
        } else {
          customQuestions.push(section);
        }

        localStorage.setItem(
          "customQuestions",
          JSON.stringify(customQuestions)
        );
        closeModal();
        renderCustomQuestionSets();
        renderCustomQuestions();
      }

      function renderCustomQuestions() {
        const questionsSection = document.querySelector(".questions-section");

        // Remove existing custom sections
        document
          .querySelectorAll(".custom-questions-content")
          .forEach((el) => el.remove());
        document
          .querySelectorAll(".custom-tab-btn")
          .forEach((el) => el.remove());

        if (customQuestions.length === 0) return;

        // Add tabs for custom questions
        const tabsContainer = document.querySelector(".questions-tabs");
        customQuestions.forEach((section, index) => {
          const tabBtn = document.createElement("button");
          tabBtn.className = "tab-btn custom-tab-btn";
          tabBtn.onclick = () => switchTab(`custom-${index}`);
          tabBtn.innerHTML = `<span class="icon">${section.icon}</span>${section.title}`;
          tabsContainer.appendChild(tabBtn);
        });

        // Add content for custom questions
        customQuestions.forEach((section, index) => {
          const contentDiv = document.createElement("div");
          contentDiv.className = "questions-content custom-questions-content";
          contentDiv.id = `custom-${index}-questions`;

          let html = "";
          section.questions.forEach((question, qIndex) => {
            html += `
              <div class="question-card">
                <div class="question-label">${qIndex + 1}. ${question}</div>
                <textarea id="custom-${index}-q${
              qIndex + 1
            }" placeholder="Write your answer here..."></textarea>
              </div>
            `;
          });

          html += `
            <button class="submit-btn" onclick="submitCustomAnswers(${index})">
              Submit ${section.title} Reflection
            </button>
            <div class="status-message" id="custom-${index}-status"></div>
          `;

          contentDiv.innerHTML = html;
          questionsSection.appendChild(contentDiv);
        });
      }

      function submitCustomAnswers(sectionIndex) {
        const dateKey = getTodayDateKey();
        const section = customQuestions[sectionIndex];
        const answers = {};
        let allFilled = true;

        section.questions.forEach((q, qIndex) => {
          const textarea = document.getElementById(
            `custom-${sectionIndex}-q${qIndex + 1}`
          );
          answers[`q${qIndex + 1}`] = textarea.value.trim();
          if (!answers[`q${qIndex + 1}`]) {
            allFilled = false;
          }
        });

        if (!allFilled) {
          const confirmed = confirm(
            "Some questions are not answered. Do you want to save anyway?"
          );
          if (!confirmed) return;
        }

        // Save to storage
        if (!reflectionData[dateKey]) {
          reflectionData[dateKey] = {};
        }
        reflectionData[dateKey][`custom_${sectionIndex}`] = answers;
        reflectionData[dateKey][`custom_${sectionIndex}_timestamp`] =
          new Date().toISOString();
        reflectionData[dateKey][`custom_${sectionIndex}_title`] = section.title;
        reflectionData[dateKey][`custom_${sectionIndex}_icon`] = section.icon;

        localStorage.setItem("reflectionData", JSON.stringify(reflectionData));

        // Show success message
        const statusDiv = document.getElementById(
          `custom-${sectionIndex}-status`
        );
        statusDiv.className = "status-message success";
        statusDiv.textContent = `‚úì ${section.title} reflection saved successfully!`;
        statusDiv.style.display = "block";

        setTimeout(() => {
          statusDiv.style.display = "none";
        }, 3000);

        // Refresh calendars
        renderADCalendar();
        renderNepaliCalendar();
      }

      // Initialize on load
      init();
    </script>
  </body>
</html>
